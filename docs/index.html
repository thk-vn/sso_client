<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Laravel SSO Client Package - Package x√°c th·ª±c OAuth2 cho Laravel">
    <title>SSO Client Package - Documentation</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        window.Prism = window.Prism || {};
        window.Prism.manual = true;
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-env.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>THK - SSO Client</h1>
                <p class="version">v1.0.0</p>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="#introduction" class="nav-link active">Gi·ªõi thi·ªáu</a></li>
                    <li><a href="#installation" class="nav-link">C√†i ƒë·∫∑t</a></li>
                    <li><a href="#configuration" class="nav-link">C·∫•u h√¨nh</a></li>
                    <li><a href="#usage" class="nav-link">S·ª≠ d·ª•ng</a></li>
                    <li><a href="#methods" class="nav-link">Methods</a></li>
                    <li><a href="#middleware" class="nav-link">Middleware</a></li>
                    <li><a href="#navigation-menu" class="nav-link">Navigation Menu</a></li>
                    <li><a href="#remote-logout" class="nav-link">Remote Logout</a></li>
                    <li><a href="#examples" class="nav-link">V√≠ d·ª•</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="https://github.com/thk-hd/sso_client" target="_blank" class="github-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    GitHub
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Introduction -->
            <section id="introduction" class="section">
                <h1>üìÑ Package Laravel x√°c th·ª±c OAuth2 (SSO Client)</h1>
                
                <h2>üîñ M√¥ t·∫£ chung</h2>
                <p><strong>M·ª•c ti√™u:</strong> X√¢y d·ª±ng m·ªôt Laravel package ƒë√≥ng vai tr√≤ nh∆∞ m·ªôt <strong>client th∆∞ vi·ªán OAuth2</strong>, ph·ª•c v·ª• vi·ªác x√°c th·ª±c ng∆∞·ªùi d√πng th√¥ng qua h·ªá th·ªëng <strong>SSO (Single Sign-On)</strong>.</p>
                
                <p><strong>ƒê·ªëi t∆∞·ª£ng s·ª≠ d·ª•ng:</strong> C√°c h·ªá th·ªëng Laravel kh√°c (g·ªçi l√† <strong>client app</strong>) mu·ªën x√°c th·ª±c ng∆∞·ªùi d√πng th√¥ng qua h·ªá th·ªëng <strong>SSO Provider</strong> trung t√¢m.</p>
                
                <p><strong>K·∫øt qu·∫£ mong ƒë·ª£i:</strong> M·ªôt package Laravel ho√†n ch·ªânh, d·ªÖ c√†i ƒë·∫∑t v√† t√≠ch h·ª£p, cho ph√©p client app:</p>
                <ul>
                    <li>Redirect ng∆∞·ªùi d√πng t·ªõi SSO ƒë·ªÉ ƒëƒÉng nh·∫≠p</li>
                    <li>Nh·∫≠n token v√† th√¥ng tin ng∆∞·ªùi d√πng</li>
                    <li>T·ª± ƒë·ªông x·ª≠ l√Ω x√°c th·ª±c v√† l∆∞u th√¥ng tin ƒëƒÉng nh·∫≠p</li>
                    <li>G·ªçi ƒë∆∞·ª£c API v·ªõi token ƒë√£ nh·∫≠n</li>
                </ul>

                <h2>‚öôÔ∏è K·ªπ thu·∫≠t s·ª≠ d·ª•ng</h2>
                <ul>
                    <li><strong>Chu·∫©n x√°c th·ª±c:</strong> OAuth2 Authorization Code Flow</li>
                    <li><strong>Laravel version:</strong> T∆∞∆°ng th√≠ch Laravel 9 tr·ªü l√™n</li>
                </ul>
            </section>

            <!-- Installation -->
            <section id="installation" class="section">
                <h2>üì¶ C√†i ƒë·∫∑t</h2>
                
                <h3>A. C√†i ƒë·∫∑t Package</h3>
                <pre><code class="language-bash">composer require thk-hd/sso-client</code></pre>

                <h3>B. Ch·∫°y Install Command (Khuy·∫øn ngh·ªã)</h3>
                <pre><code class="language-bash">php artisan sso-client:install</code></pre>
                <p>Command n√†y s·∫Ω t·ª± ƒë·ªông:</p>
                <ul>
                    <li>‚úÖ Publish config file</li>
                    <li>‚úÖ T·∫°o routes file v·ªõi ƒë·∫ßy ƒë·ªß routes</li>
                    <li>‚úÖ Th√™m bi·∫øn m√¥i tr∆∞·ªùng v√†o .env</li>
                    <li>‚úÖ Load routes file</li>
                    <li>‚úÖ Register middleware</li>
                    <li>‚úÖ Configure admin check</li>
                </ul>

                <h3>C. Setup th·ªß c√¥ng (n·∫øu kh√¥ng d√πng install command)</h3>
                <pre><code class="language-bash">php artisan vendor:publish --tag=sso-client-config</code></pre>
            </section>

            <!-- Configuration -->
            <section id="configuration" class="section">
                <h2>‚öôÔ∏è C·∫•u h√¨nh</h2>
                
                <h3>Environment Variables</h3>
                <p>Th√™m v√†o file <code>.env</code>:</p>
                <pre><code class="language-env">SSO_SERVER_URL=http://127.0.0.1:8001
SSO_CLIENT_ID=xxxxxxxxxxxxxxxxxx
SSO_CLIENT_SECRET=xxxxxxxxxxxxxxxxxx
SSO_REDIRECT_URI=http://localhost:8000/callback
SSO_MENUS_URI=/api/menus
SSO_NAVIGATION_ENABLED=true
SSO_REMOTE_LOGOUT_SECRET=your-strong-secret-token-here
SSO_REMOTE_LOGOUT_ENABLED=true</code></pre>

                <h3>T·∫°o Remote Logout Secret</h3>
                <pre><code class="language-bash"># C√°ch 1: D√πng PHP
php -r "echo bin2hex(random_bytes(32));"

# C√°ch 2: D√πng OpenSSL
openssl rand -hex 32</code></pre>
            </section>

            <!-- Usage -->
            <section id="usage" class="section">
                <h2>üöÄ S·ª≠ d·ª•ng nhanh</h2>
                
                <h3>1. S·ª≠ d·ª•ng Install Command</h3>
                <pre><code class="language-bash">php artisan sso-client:install</code></pre>
                <p>Sau ƒë√≥ load routes file trong <code>routes/web.php</code>:</p>
                <pre><code class="language-php">require __DIR__.'/sso-client.php';</code></pre>

                <h3>2. Register Middleware</h3>
                <p>Trong <code>bootstrap/app.php</code>:</p>
                <pre><code class="language-php">use THKHD\SsoClient\Http\Middleware\AdminMiddleware;
use THKHD\SsoClient\Http\Middleware\PermissionMiddleware;
use THKHD\SsoClient\Http\Middleware\RefreshNavigationMiddleware;

->withMiddleware(function (Middleware $middleware) {
    $middleware->web([RefreshNavigationMiddleware::class]);
    $middleware->alias([
        'admin' => AdminMiddleware::class,
        'permission' => PermissionMiddleware::class,
    ]);
})</code></pre>

                <h3>3. Configure Admin Check</h3>
                <p>Trong <code>AppServiceProvider::boot()</code>:</p>
                <pre><code class="language-php">config(['sso-client.admin_check' => fn($user) => $user->role === 'admin']);</code></pre>
            </section>

            <!-- Methods -->
            <section id="methods" class="section">
                <h2>üîß C√°c Method c√≥ s·∫µn</h2>
                
                <h3>Authentication Methods</h3>
                <div class="method-list">
                    <div class="method-item">
                        <code>buildAuthorizationUrl(string $state, array $extraParams = [])</code>
                        <p>T·∫°o URL ƒë·ªÉ redirect ƒë·∫øn SSO</p>
                    </div>
                    <div class="method-item">
                        <code>getAccessToken(string $code)</code>
                        <p>L·∫•y access token t·ª´ authorization code</p>
                    </div>
                    <div class="method-item">
                        <code>getUser(string $accessToken)</code>
                        <p>L·∫•y th√¥ng tin user t·ª´ SSO server</p>
                    </div>
                    <div class="method-item">
                        <code>validateState(?string $sessionState, ?string $requestState)</code>
                        <p>Validate state parameter ƒë·ªÉ ch·ªëng CSRF</p>
                    </div>
                </div>

                <h3>Token Management</h3>
                <div class="method-list">
                    <div class="method-item">
                        <code>saveSSOToken(string $token)</code>
                        <p>L∆∞u token v√†o session</p>
                    </div>
                    <div class="method-item">
                        <code>getSSOToken()</code>
                        <p>L·∫•y token t·ª´ session</p>
                    </div>
                    <div class="method-item">
                        <code>clearSSOToken()</code>
                        <p>X√≥a token kh·ªèi session</p>
                    </div>
                    <div class="method-item">
                        <code>revokeToken(string $accessToken)</code>
                        <p>Revoke token tr√™n SSO server</p>
                    </div>
                </div>

                <h3>Navigation Menu</h3>
                <div class="method-list">
                    <div class="method-item">
                        <code>storeNavigationMenu(string $accessToken, ?string $lang = 'en')</code>
                        <p>L·∫•y v√† l∆∞u navigation menu t·ª´ SSO</p>
                    </div>
                    <div class="method-item">
                        <code>getNavigationMenu()</code>
                        <p>L·∫•y navigation menu t·ª´ session</p>
                    </div>
                    <div class="method-item">
                        <code>clearNavigationMenu()</code>
                        <p>X√≥a navigation menu kh·ªèi session</p>
                    </div>
                </div>

                <h3>User Management</h3>
                <div class="method-list">
                    <div class="method-item">
                        <code>createOrUpdateUser(array $userData, ?callable $callback = null)</code>
                        <p>T·∫°o ho·∫∑c c·∫≠p nh·∫≠t user t·ª´ SSO data</p>
                    </div>
                    <div class="method-item">
                        <code>forceLogout(string|int $identifier)</code>
                        <p>Force logout user theo email ho·∫∑c user_id</p>
                    </div>
                </div>
            </section>

            <!-- Middleware -->
            <section id="middleware" class="section">
                <h2>üõ°Ô∏è Middleware</h2>
                
                <div class="middleware-item">
                    <h3>RefreshNavigationMiddleware</h3>
                    <p>T·ª± ƒë·ªông refresh navigation menu t·ª´ SSO v√† ƒë·∫£m b·∫£o token h·ª£p l·ªá. Middleware s·∫Ω t·ª± ƒë·ªông skip n·∫øu:</p>
                    <ul>
                        <li>User ch∆∞a ƒëƒÉng nh·∫≠p (guest)</li>
                        <li>Route n·∫±m trong <code>config('sso-client.middleware.skip_routes')</code></li>
                        <li><code>navigation_enabled</code> = <code>false</code></li>
                    </ul>
                    <pre><code class="language-php">$middleware->web([RefreshNavigationMiddleware::class]);</code></pre>
                </div>

                <div class="middleware-item">
                    <h3>PermissionMiddleware</h3>
                    <p>Ki·ªÉm tra quy·ªÅn truy c·∫≠p d·ª±a tr√™n permissions t·ª´ SSO session</p>
                    <pre><code class="language-php">Route::middleware(['auth', 'permission:app.dashboard'])->group(function () {
    // Protected routes
});</code></pre>
                </div>

                <div class="middleware-item">
                    <h3>AdminMiddleware</h3>
                    <p>Ki·ªÉm tra user c√≥ ph·∫£i admin kh√¥ng</p>
                    <pre><code class="language-php">Route::middleware(['auth', 'admin'])->group(function () {
    // Admin routes
});</code></pre>
                </div>

                <div class="middleware-item">
                    <h3>ValidateSSOSecretMiddleware</h3>
                    <p>X√°c th·ª±c secret token cho remote logout endpoint</p>
                    <pre><code class="language-php">Route::middleware([ValidateSSOSecretMiddleware::class])->group(function () {
    Route::post('remote-logout', [SSOAuthenticateController::class, 'forceLogout']);
});</code></pre>
                </div>
            </section>

            <!-- Navigation Menu -->
            <section id="navigation-menu" class="section">
                <h2>üß≠ Navigation Menu</h2>
                
                <h3>M√¥ t·∫£</h3>
                <p>T√≠nh nƒÉng Navigation Menu cho ph√©p client app hi·ªÉn th·ªã menu ƒëi·ªÅu h∆∞·ªõng ƒë∆∞·ª£c qu·∫£n l√Ω t·∫≠p trung t·ª´ SSO server. Menu ƒë∆∞·ª£c fetch t·ª± ƒë·ªông t·ª´ SSO server v√† cache trong session, gi√∫p:</p>
                <ul>
                    <li>Qu·∫£n l√Ω menu t·∫≠p trung t·ª´ SSO server</li>
                    <li>T·ª± ƒë·ªông c·∫≠p nh·∫≠t menu khi c√≥ thay ƒë·ªïi</li>
                    <li>H·ªó tr·ª£ ƒëa ng√¥n ng·ªØ (language)</li>
                    <li>T·ª± ƒë·ªông refresh menu khi c·∫ßn thi·∫øt</li>
                </ul>

                <h3>C·∫•u h√¨nh</h3>
                <p>Th√™m v√†o <code>.env</code>:</p>
                <pre><code class="language-env">SSO_NAVIGATION_ENABLED=true
SSO_MENUS_URI=/api/menus</code></pre>

                <div class="info-box">
                    <strong>Gi·∫£i th√≠ch:</strong>
                    <ul>
                        <li><code>SSO_NAVIGATION_ENABLED</code>: B·∫≠t/t·∫Øt t√≠nh nƒÉng navigation menu (m·∫∑c ƒë·ªãnh: <code>true</code>)</li>
                        <li><code>SSO_MENUS_URI</code>: Endpoint tr√™n SSO server ƒë·ªÉ fetch menu (m·∫∑c ƒë·ªãnh: <code>/api/menus</code>)</li>
                    </ul>
                </div>

                <h3>C√°ch s·ª≠ d·ª•ng</h3>
                
                <h4>C√°ch 1: S·ª≠ d·ª•ng View Component (Khuy·∫øn ngh·ªã)</h4>
                <pre><code class="language-php">{{-- resources/views/layouts/app.blade.php --}}
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;My App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    {{-- Hi·ªÉn th·ªã navigation menu t·ª´ SSO --}}
    &lt;x-sso::navigation-menu /&gt;
    
    &lt;main&gt;
        {{ $slot }}
    &lt;/main&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                <h4>C√°ch 2: S·ª≠ d·ª•ng trong View Component t√πy ch·ªânh</h4>
                <pre><code class="language-php">// app/View/Components/AppLayout.php
namespace App\View\Components;

use Illuminate\View\Component;
use THKHD\SsoClient\Services\SSOClientService;

class AppLayout extends Component
{
    public function __construct(private SSOClientService $ssoService) {}

    public function render()
    {
        $navigation = $this->ssoService->getNavigationMenu();
        
        return view('layouts.app', compact('navigation'));
    }
}</code></pre>

                <pre><code class="language-php">{{-- resources/views/layouts/app.blade.php --}}
@if(config('sso-client.navigation_enabled', true) && !empty($navigation))
    {!! $navigation !!}
@endif</code></pre>

                <h4>C√°ch 3: S·ª≠ d·ª•ng Facade tr·ª±c ti·∫øp</h4>
                <pre><code class="language-php">use THKHD\SsoClient\Facades\SSOClient;

$navigation = SSOClient::getNavigationMenu();

if (config('sso-client.navigation_enabled', true) && !empty($navigation)) {
    echo $navigation;
}</code></pre>

                <h3>T·ª± ƒë·ªông l∆∞u Menu sau khi ƒëƒÉng nh·∫≠p</h3>
                <p>Menu s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông fetch v√† l∆∞u sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng n·∫øu b·∫°n s·ª≠ d·ª•ng <code>SSOAuthenticateController</code> ho·∫∑c <code>BaseSSOAuthenticateController</code>.</p>
                
                <p>N·∫øu b·∫°n t·ª± x·ª≠ l√Ω callback, h√£y g·ªçi <code>storeNavigationMenu()</code> sau khi l·∫•y ƒë∆∞·ª£c access token:</p>
                <pre><code class="language-php">use THKHD\SsoClient\Facades\SSOClient;

public function handleCallback(Request $request)
{
    // ... x·ª≠ l√Ω authentication ...
    
    $tokenData = SSOClient::getAccessToken($request->code);
    $accessToken = $tokenData['access_token'];
    
    // L∆∞u navigation menu v·ªõi ng√¥n ng·ªØ hi·ªán t·∫°i
    $locale = $request->session()->get('locale', config('app.locale', 'en'));
    SSOClient::storeNavigationMenu($accessToken, $locale);
    
    // ... ti·∫øp t·ª•c x·ª≠ l√Ω ...
}</code></pre>

                <h3>Refresh Menu khi ƒë·ªïi ng√¥n ng·ªØ</h3>
                <p>Khi user ƒë·ªïi ng√¥n ng·ªØ, b·∫°n c·∫ßn refresh menu v·ªõi ng√¥n ng·ªØ m·ªõi:</p>
                <pre><code class="language-php">use THKHD\SsoClient\Facades\SSOClient;

public function switchLanguage(Request $request, string $language)
{
    $request->session()->put('locale', $language);
    
    // Refresh navigation menu v·ªõi ng√¥n ng·ªØ m·ªõi
    $accessToken = SSOClient::getSSOToken();
    if ($accessToken) {
        SSOClient::storeNavigationMenu($accessToken, $language);
    }
    
    return redirect()->back();
}</code></pre>

                <h3>T·∫Øt Navigation Menu</h3>
                <p>N·∫øu b·∫°n kh√¥ng mu·ªën s·ª≠ d·ª•ng navigation menu t·ª´ SSO, c√≥ th·ªÉ t·∫Øt b·∫±ng c√°ch:</p>
                <pre><code class="language-env"># Option 1: T·∫Øt trong .env
SSO_NAVIGATION_ENABLED=false</code></pre>

                <pre><code class="language-php">// Option 2: T·∫Øt trong config
// config/sso-client.php
'navigation_enabled' => false,</code></pre>

                <h3>API Endpoint tr√™n SSO Server</h3>
                <p>SSO server c·∫ßn cung c·∫•p endpoint <code>/api/menus</code> (ho·∫∑c endpoint ƒë∆∞·ª£c config trong <code>SSO_MENUS_URI</code>) v·ªõi:</p>
                
                <p><strong>Request:</strong></p>
                <pre><code class="language-bash">GET /api/menus?lang=en&client_url=http://client-app.com
Headers:
  Authorization: Bearer {access_token}</code></pre>

                <p><strong>Response (Success - 200):</strong></p>
                <pre><code class="language-html">&lt;nav&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href="/dashboard"&gt;Dashboard&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href="/users"&gt;Users&lt;/a&gt;&lt;/li&gt;
        &lt;!-- ... --&gt;
    &lt;/ul&gt;
&lt;/nav&gt;</code></pre>

                <p><strong>Response (Forbidden - 403):</strong></p>
                <pre><code class="language-json">{
    "message": "User does not have permission for this client"
}</code></pre>

                <h3>Best Practices</h3>
                <ul>
                    <li><strong>Lu√¥n check config:</strong> Lu√¥n check <code>navigation_enabled</code> tr∆∞·ªõc khi hi·ªÉn th·ªã menu</li>
                    <li><strong>X·ª≠ l√Ω menu r·ªóng:</strong> Lu√¥n ki·ªÉm tra menu c√≥ r·ªóng kh√¥ng tr∆∞·ªõc khi render</li>
                    <li><strong>Cache menu:</strong> Menu ƒë∆∞·ª£c cache trong session, kh√¥ng c·∫ßn fetch l·∫°i m·ªói request</li>
                    <li><strong>Refresh khi ƒë·ªïi ng√¥n ng·ªØ:</strong> Nh·ªõ refresh menu khi user ƒë·ªïi ng√¥n ng·ªØ</li>
                </ul>
            </section>

            <!-- Remote Logout -->
            <section id="remote-logout" class="section">
                <h2>üîê Remote Logout (Force Logout t·ª´ SSO Server)</h2>
                
                <h3>M√¥ t·∫£</h3>
                <p>T√≠nh nƒÉng cho ph√©p SSO server g·ªçi endpoint ƒë·ªÉ force logout user ƒëang ƒëƒÉng nh·∫≠p tr√™n client app. H·ªØu √≠ch khi:</p>
                <ul>
                    <li>SSO server thay ƒë·ªïi quy·ªÅn c·ªßa user</li>
                    <li>SSO server y√™u c·∫ßu b·∫Øt bu·ªôc logout (b·∫£o m·∫≠t, v.v.)</li>
                    <li>User b·ªã v√¥ hi·ªáu h√≥a tr√™n SSO server</li>
                </ul>

                <h3>SSO_REMOTE_LOGOUT_SECRET l√† g√¨?</h3>
                <p><code>SSO_REMOTE_LOGOUT_SECRET</code> l√† m·ªôt <strong>secret token</strong> d√πng ƒë·ªÉ x√°c th·ª±c c√°c request t·ª´ SSO server khi g·ªçi endpoint remote logout. ƒê√¢y l√† m·ªôt chu·ªói b√≠ m·∫≠t ƒë∆∞·ª£c chia s·∫ª gi·ªØa SSO server v√† client app.</p>
                
                <div class="info-box">
                    <strong>M·ª•c ƒë√≠ch:</strong>
                    <ul>
                        <li><strong>B·∫£o m·∫≠t:</strong> Ch·ªâ SSO server bi·∫øt secret m·ªõi c√≥ th·ªÉ g·ªçi endpoint force logout</li>
                        <li><strong>NgƒÉn ch·∫∑n:</strong> Tr√°nh ng∆∞·ªùi l·∫° g·ªçi endpoint v√† logout user b·∫•t h·ª£p ph√°p</li>
                        <li><strong>Audit:</strong> Log t·∫•t c·∫£ requests ƒë·ªÉ theo d√µi v√† audit</li>
                    </ul>
                </div>

                <h3>C√°ch t·∫°o Secret</h3>
                <pre><code class="language-bash"># C√°ch 1: D√πng PHP
php -r "echo bin2hex(random_bytes(32));"

# C√°ch 2: D√πng OpenSSL
openssl rand -hex 32

# C√°ch 3: D√πng Laravel Tinker
php artisan tinker
>>> bin2hex(random_bytes(32))</code></pre>

                <h3>SSO Server g·ªçi endpoint</h3>
                <p><strong>Option 1: D√πng Header</strong></p>
                <pre><code class="language-bash">curl -X POST https://your-app.com/remote-logout \
  -H "X-SSO-Secret: your-strong-secret-token-here" \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com"}'</code></pre>

                <p><strong>Option 2: D√πng Query Parameter</strong></p>
                <pre><code class="language-bash">curl -X POST "https://your-app.com/remote-logout?secret=your-strong-secret-token-here" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 123}'</code></pre>

                <h3>Response</h3>
                <p><strong>Success:</strong></p>
                <pre><code class="language-json">{
  "success": true,
  "message": "User logged out successfully",
  "identifier": "user@example.com"
}</code></pre>

                <h3>L∆∞u Secret trong Database c·ªßa SSO Server</h3>
                <p><strong>C√≥ th·ªÉ l∆∞u secret v√†o DB c·ªßa SSO server kh√¥ng?</strong> ‚úÖ <strong>C√≥, v√† ƒë√¢y l√† c√°ch t·ªët!</strong></p>
                
                <p>Khi qu·∫£n l√Ω nhi·ªÅu client apps, SSO server n√™n l∆∞u secret c·ªßa t·ª´ng client v√†o database ƒë·ªÉ:</p>
                <ul>
                    <li><strong>Qu·∫£n l√Ω t·∫≠p trung:</strong> T·∫•t c·∫£ secrets ·ªü m·ªôt n∆°i</li>
                    <li><strong>D·ªÖ rotate:</strong> C√≥ th·ªÉ ƒë·ªïi secret m√† kh√¥ng c·∫ßn c·∫≠p nh·∫≠t code</li>
                    <li><strong>Audit trail:</strong> Theo d√µi l·ªãch s·ª≠ thay ƒë·ªïi secret</li>
                    <li><strong>Multi-tenant:</strong> M·ªói client c√≥ secret ri√™ng, ƒë·ªôc l·∫≠p</li>
                </ul>

                <h4>C·∫•u tr√∫c Database ƒë·ªÅ xu·∫•t:</h4>
                <pre><code class="language-sql">CREATE TABLE sso_clients (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    client_id VARCHAR(255) UNIQUE NOT NULL,
    client_secret VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    redirect_uri TEXT,
    remote_logout_secret VARCHAR(255) NOT NULL,
    remote_logout_url VARCHAR(500),
    remote_logout_enabled BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);</code></pre>

                <h4>Laravel Model (SSO Server):</h4>
                <pre><code class="language-php">use Illuminate\Database\Eloquent\Casts\Encrypted;

class SSOClient extends Model
{
    protected $casts = [
        'remote_logout_secret' => Encrypted::class,
        'remote_logout_enabled' => 'boolean',
    ];

    public function forceLogoutUser($userId, $userEmail = null)
    {
        if (!$this->remote_logout_enabled) {
            return ['success' => false, 'message' => 'Remote logout disabled'];
        }

        $response = Http::withHeaders([
            'X-SSO-Secret' => $this->remote_logout_secret,
        ])->post($this->remote_logout_url, [
            'user_id' => $userId,
            'email' => $userEmail,
        ]);

        return $response->json();
    }
}</code></pre>
            </section>

            <!-- Examples -->
            <section id="examples" class="section">
                <h2>üìù V√≠ d·ª• s·ª≠ d·ª•ng</h2>
                
                <h3>V√≠ d·ª• ƒë·∫ßy ƒë·ªß</h3>
                <pre><code class="language-php">use THKHD\SsoClient\Facades\SSOClient;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Str;

// 1. Redirect to SSO
public function redirectToSSO(Request $request)
{
    $state = Str::random(40);
    $request->session()->put('sso_state', $state);
    $redirectUrl = SSOClient::buildAuthorizationUrl($state);
    return redirect($redirectUrl);
}

// 2. Handle callback
public function handleCallback(Request $request)
{
    $sessionState = $request->session()->pull('sso_state');
    $requestState = $request->query('state');
    
    if (!SSOClient::validateState($sessionState, $requestState)) {
        abort(403, 'Invalid state');
    }
    
    try {
        $tokenData = SSOClient::getAccessToken($request->code);
        $accessToken = $tokenData['access_token'];
        $userInfo = SSOClient::getUser($accessToken);
        
        $user = SSOClient::createOrUpdateUser($userInfo);
        
        // Store navigation menu (ch·ªâ khi navigation_enabled = true)
        if (config('sso-client.navigation_enabled', true)) {
            $locale = $request->session()->get('locale', 'en');
            SSOClient::storeNavigationMenu($accessToken, $locale);
        }
        
        Auth::login($user, true);
        $request->session()->put('sso_token', $accessToken);
        $request->session()->put('sso_permissions', $userInfo['permissions'] ?? []);
        
        return redirect()->intended('/');
    } catch (\Exception $e) {
        logger()->error('SSO authentication failed', ['error' => $e->getMessage()]);
        return redirect()->route('login')->with('error', $e->getMessage());
    }
}</code></pre>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <p>üì¶ Package: <strong>thk-hd/sso-client</strong></p>
                <p>üìÑ License: MIT</p>
                <p>üîó <a href="https://github.com/thk-hd/sso_client" target="_blank">GitHub Repository</a></p>
            </footer>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>

